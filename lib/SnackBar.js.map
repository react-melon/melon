{"version":3,"sources":["/src/SnackBar.js"],"names":["dom","cx","SnackBar","props","autoHideTimer","onMouseUp","bind","onHide","state","open","componentDidMount","window","addEventListener","openOnMount","onShow","locate","componentWillReceiveProps","nextProps","componentDidUpdate","componentWillUnmount","removeEventListener","clearTimeout","direction","main","findDOMNode","style","marginTop","marginLeft","offsetWidth","offsetHeight","setState","autoHideDuration","setTimeout","e","event","target","srcElement","contains","render","message","action","className","addStates","addVariants","build","part","displayName","defaultProps","propTypes","string","number","node","isRequired","bool","func","oneOf","show","duration","doc","document","body","container","createElement","appendChild","snackbar","unmountComponentAtNode","removeChild","cloneElement"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;QASYA,G;AATZ;;;;;;AAYA,QAAMC,KAAK,uBAAO,UAAP,CAAX;;AAEA;;;;;;;QAMqBC,Q;;;AAEjB;;;;;;;AAOA,0BAAYC,KAAZ,EAAmB;AAAA;;AAAA,qEAEf,sBAAMA,KAAN,CAFe;;AAIf;;;;;AAKA,kBAAKC,aAAL,GAAqB,IAArB;;AAEA,kBAAKC,SAAL,GAAiB,MAAKA,SAAL,CAAeC,IAAf,OAAjB;AACA,kBAAKC,MAAL,GAAc,MAAKA,MAAL,CAAYD,IAAZ,OAAd;;AAEA;;;;;AAKA,kBAAKE,KAAL,GAAa;AACTC,sBAAMN,MAAMM;AADH,aAAb;;AAnBe;AAuBlB;;AAED;;;;;;;;2BAMAC,iB,gCAAoB;;AAEhBC,mBAAOC,gBAAP,CAAwB,SAAxB,EAAmC,KAAKP,SAAxC;;AAEA,gBAAI,KAAKF,KAAL,CAAWU,WAAf,EAA4B;AACxB,qBAAKC,MAAL;AACH;;AAED,iBAAKC,MAAL;AAEH,S;;2BASDC,yB,sCAA0BC,S,EAAW;;AAEjC,gBAAMR,OAAOQ,UAAUR,IAAvB;;AAEA,gBAAIA,SAAS,KAAKD,KAAL,CAAWC,IAAxB,EAA8B;AAC1B;AACH;;AAEDA,mBAAO,KAAKK,MAAL,EAAP,GAAuB,KAAKP,MAAL,EAAvB;AAEH,S;;2BAQDW,kB,iCAAqB;AACjB,iBAAKH,MAAL;AACH,S;;2BAQDI,oB,mCAAuB;;AAEnBR,mBAAOS,mBAAP,CAA2B,SAA3B,EAAsC,KAAKf,SAA3C;;AAEA,gBAAI,KAAKD,aAAT,EAAwB;AACpBiB,6BAAa,KAAKjB,aAAlB;AACH;AAEJ,S;;2BAQDW,M,qBAAS;;AAEL,gBAAMO,YAAY,KAAKnB,KAAL,CAAWmB,SAA7B;;AAEA,gBAAMb,OAAO,KAAKD,KAAL,CAAWC,IAAxB;;AAEA,gBAAMc,OAAO,sBAASC,WAAT,CAAqB,IAArB,CAAb;;AAEA,gBAAIf,IAAJ,EAAU;AACN;AACH;;AAED,oBAAQa,SAAR;AACI,qBAAK,IAAL;AACA,qBAAK,IAAL;AACIC,yBAAKE,KAAL,CAAWC,SAAX,GAAuB,EAAvB;AACAH,yBAAKE,KAAL,CAAWE,UAAX,GAAwB,CAACJ,KAAKK,WAAN,GAAoB,CAApB,GAAwB,IAAhD;AACA;AACJ,qBAAK,IAAL;AACA,qBAAK,IAAL;AACIL,yBAAKE,KAAL,CAAWE,UAAX,GAAwB,EAAxB;AACAJ,yBAAKE,KAAL,CAAWC,SAAX,GAAuB,CAACH,KAAKM,YAAN,GAAqB,CAArB,GAAyB,IAAhD;AACA;AAVR;AAaH,S;;2BAODtB,M,qBAAS;;AAEL,gBAAMA,SAAS,KAAKJ,KAAL,CAAWI,MAA1B;;AAEA,iBAAKuB,QAAL,CAAc,EAACrB,MAAM,KAAP,EAAd,EAA6B,YAAY;AACrC,oBAAIF,MAAJ,EAAY;AACRA;AACH;AACJ,aAJD;AAMH,S;;2BAODO,M,qBAAS;AAAA,yBAKD,KAAKX,KALJ;AAAA,gBAGDW,MAHC,UAGDA,MAHC;AAAA,gBAIDiB,gBAJC,UAIDA,gBAJC;;;AAOL,iBAAKD,QAAL,CAAc,EAACrB,MAAM,IAAP,EAAd,EAA4B,YAAY;AAAA;;AAEpC,oBAAIK,MAAJ,EAAY;AACRA;AACH;;AAED,oBAAIiB,mBAAmB,CAAvB,EAA0B;;AAEtB,yBAAK3B,aAAL,GAAqB4B,WACjB,YAAM;AACF,+BAAKzB,MAAL;AACH,qBAHgB,EAIjBwB,gBAJiB,CAArB;AAOH;AAEJ,aAjBD;AAmBH,S;;2BAQD1B,S,sBAAU4B,C,EAAG;;AAET,gBAAI,CAAC,KAAKzB,KAAL,CAAWC,IAAhB,EAAsB;AAClB;AACH;;AAEDwB,gBAAIA,KAAKtB,OAAOuB,KAAhB;;AAEA,gBAAMC,SAASF,EAAEE,MAAF,IAAYF,EAAEG,UAA7B;;AAEA,gBAAMb,OAAO,sBAASC,WAAT,CAAqB,IAArB,CAAb;;AAEA;AACA,gBAAID,SAASY,MAAT,IAAmB,CAACZ,KAAKc,QAAL,CAAcF,MAAd,CAAxB,EAA+C;AAC3C,qBAAK5B,MAAL;AACA;AACH;AACJ,S;;2BAQD+B,M,qBAAS;AAAA,0BAMD,KAAKnC,KANJ;AAAA,gBAGDoC,OAHC,WAGDA,OAHC;AAAA,gBAIDC,MAJC,WAIDA,MAJC;AAAA,gBAKDlB,SALC,WAKDA,SALC;;;AAQL,gBAAMb,OAAO,KAAKD,KAAL,CAAWC,IAAxB;;AAEA,gBAAMgC,YAAYxC,GAAG,KAAKE,KAAR,EACbuC,SADa,CACH,EAACjC,UAAD,EADG,EAEbkC,WAFa,gBAEYrB,SAFZ,EAGbsB,KAHa,EAAlB;;AAKA,mBACI;AAAA;AAAA,kBAAK,WAAWH,SAAhB;AACI;AAAA;AAAA,sBAAM,WAAWxC,KAAK4C,IAAL,CAAU,SAAV,EAAqBD,KAArB,EAAjB;AACKL;AADL,iBADJ;AAII;AAAA;AAAA;AACI,kCAAU,CAAC,UAAD,CADd;AAEI,mCAAWtC,KAAK4C,IAAL,CAAU,QAAV,EAAoBD,KAApB,EAFf;AAGI,iCAAS,KAAKrC,MAHlB;AAIKiC;AAJL;AAJJ,aADJ;AAcH,S;;;;;yBAhPgBtC,Q;;;AAoPrBA,aAAS4C,WAAT,GAAuB,UAAvB;;AAEA5C,aAAS6C,YAAT,GAAwB;AACpBhB,0BAAkB,CADE;AAEpBS,gBAAQ,IAFY;AAGpBlB,mBAAW;AAHS,KAAxB;;AAMApB,aAAS8C,SAAT,GAAqB;AACjBR,gBAAQ,iBAAUS,MADD;AAEjBlB,0BAAkB,iBAAUmB,MAFX;AAGjBX,iBAAS,iBAAUY,IAAV,CAAeC,UAHP;AAIjBvC,qBAAa,iBAAUwC,IAJN;AAKjB9C,gBAAQ,iBAAU+C,IALD;AAMjBxC,gBAAQ,iBAAUwC,IAND;AAOjBhC,mBAAW,iBAAUiC,KAAV,CAAgB,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,EAAyB,IAAzB,EAA+B,IAA/B,EAAqC,IAArC,EAA2C,IAA3C,EAAiD,IAAjD,EAAuD,IAAvD,EAA6D,IAA7D,EAAmE,IAAnE,CAAhB;AAPM,KAArB;;AAWArD,aAASsD,IAAT,GAAgB,UAAUjB,OAAV,EAAmD;AAAA,YAAhCkB,QAAgC,uEAArB,CAAqB;AAAA,YAAlBnC,SAAkB,uEAAN,IAAM;;;AAE/D,YAAIoC,MAAMC,QAAV;AACA,YAAIC,OAAOF,IAAIE,IAAf;AACA,YAAIC,YAAYH,IAAII,aAAJ,CAAkB,KAAlB,CAAhB;;AAEAF,aAAKG,WAAL,CAAiBF,SAAjB;;AAEA,YAAIG,WACA,iCAAC,QAAD;AACI,8BAAkBP,QADtB;AAEI,qBAASlB,OAFb;AAGI,uBAAWjB,SAHf;AAII,oBAAQ,kBAAM;;AAEV;AACAU,2BACI,YAAM;AACF,wBAAI6B,SAAJ,EAAe;AACX,8CAASI,sBAAT,CAAgCJ,SAAhC;AACAD,6BAAKM,WAAL,CAAiBL,SAAjB;AACAD,+BAAOF,MAAMG,YAAYG,WAAW,IAApC;AACH;AACJ,iBAPL,EAQI,GARJ;AAWH,aAlBL,GADJ;;AAsBA,8BAAS1B,MAAT,CAAgB0B,QAAhB,EAA0BH,SAA1B,EAAqC,YAAM;AACvCG,uBAAW,mBAAMG,YAAN,CAAmBH,QAAnB,EAA6B,EAACvD,MAAM,IAAP,EAA7B,CAAX;AACAuB,uBACI,YAAM;AACF,sCAASM,MAAT,CAAgB0B,QAAhB,EAA0BH,SAA1B;AACH,aAHL,EAII,CAJJ;AAMH,SARD;;AAUA,eAAOG,QAAP;AACH,KAzCD","file":"SnackBar.js","sourcesContent":["/**\n * @file melon/SnackBar\n * @author cxtom<cxtom2008@gmail.com>\n * @author leon<ludafa@outlook.com>\n */\n\nimport React, {PropTypes, Component} from 'react';\nimport ReactDOM from 'react-dom';\nimport Button from './Button';\nimport * as dom from './common/util/dom';\nimport {create} from 'melon-core/classname/cxBuilder';\n\nconst cx = create('SnackBar');\n\n/**\n * melon/SnackBar\n *\n * @extends {React.Component}\n * @class\n */\nexport default class SnackBar extends Component {\n\n    /**\n     * 构造函数\n     *\n     * @public\n     * @constructor\n     * @param  {*} props   属性\n     */\n    constructor(props) {\n\n        super(props);\n\n        /**\n         * timeoutId\n         *\n         * @type {?number}\n         */\n        this.autoHideTimer = null;\n\n        this.onMouseUp = this.onMouseUp.bind(this);\n        this.onHide = this.onHide.bind(this);\n\n        /**\n         * 状态\n         *\n         * @type {Object}\n         */\n        this.state = {\n            open: props.open\n        };\n\n    }\n\n    /**\n     * Mount时的处理\n     *\n     * @public\n     * @override\n     */\n    componentDidMount() {\n\n        window.addEventListener('mouseup', this.onMouseUp);\n\n        if (this.props.openOnMount) {\n            this.onShow();\n        }\n\n        this.locate();\n\n    }\n\n    /**\n     * 接受新属性时的处理\n     *\n     * @public\n     * @override\n     * @param {*} nextProps 新属性\n     */\n    componentWillReceiveProps(nextProps) {\n\n        const open = nextProps.open;\n\n        if (open === this.state.open) {\n            return;\n        }\n\n        open ? this.onShow() : this.onHide();\n\n    }\n\n    /**\n     * 状态更新后的处理\n     *\n     * @public\n     * @override\n     */\n    componentDidUpdate() {\n        this.locate();\n    }\n\n    /**\n     * unount时的处理\n     *\n     * @public\n     * @override\n     */\n    componentWillUnmount() {\n\n        window.removeEventListener('mouseup', this.onMouseUp);\n\n        if (this.autoHideTimer) {\n            clearTimeout(this.autoHideTimer);\n        }\n\n    }\n\n    /**\n     * 定位浮层\n     *\n     * @private\n     * @return {undefined}\n     */\n    locate() {\n\n        const direction = this.props.direction;\n\n        const open = this.state.open;\n\n        const main = ReactDOM.findDOMNode(this);\n\n        if (open) {\n            return;\n        }\n\n        switch (direction) {\n            case 'bc':\n            case 'tc':\n                main.style.marginTop = '';\n                main.style.marginLeft = -main.offsetWidth / 2 + 'px';\n                break;\n            case 'lc':\n            case 'rc':\n                main.style.marginLeft = '';\n                main.style.marginTop = -main.offsetHeight / 2 + 'px';\n                break;\n        }\n\n    }\n\n    /**\n     * 显示时的处理\n     *\n     * @protected\n     */\n    onHide() {\n\n        const onHide = this.props.onHide;\n\n        this.setState({open: false}, function () {\n            if (onHide) {\n                onHide();\n            }\n        });\n\n    }\n\n    /**\n     * 隐藏时的处理\n     *\n     * @protected\n     */\n    onShow() {\n\n        const {\n            onShow,\n            autoHideDuration\n        } = this.props;\n\n        this.setState({open: true}, function () {\n\n            if (onShow) {\n                onShow();\n            }\n\n            if (autoHideDuration > 0) {\n\n                this.autoHideTimer = setTimeout(\n                    () => {\n                        this.onHide();\n                    },\n                    autoHideDuration\n                );\n\n            }\n\n        });\n\n    }\n\n    /**\n     * 鼠标抬起时处理\n     *\n     * @protected\n     * @param  {Object} e 事件对象\n     */\n    onMouseUp(e) {\n\n        if (!this.state.open) {\n            return;\n        }\n\n        e = e || window.event;\n\n        const target = e.target || e.srcElement;\n\n        const main = ReactDOM.findDOMNode(this);\n\n        // 点击不在 snackBar 内部\n        if (main !== target && !main.contains(target)) {\n            this.onHide();\n            return;\n        }\n    }\n\n    /**\n     * 渲染\n     *\n     * @public\n     * @return {ReactElement}\n     */\n    render() {\n\n        const {\n            message,\n            action,\n            direction\n        } = this.props;\n\n        const open = this.state.open;\n\n        const className = cx(this.props)\n            .addStates({open})\n            .addVariants(`direction-${direction}`)\n            .build();\n\n        return (\n            <div className={className}>\n                <span className={cx().part('message').build()}>\n                    {message}\n                </span>\n                <Button\n                    variants={['snackbar']}\n                    className={cx().part('action').build()}\n                    onClick={this.onHide} >\n                    {action}\n                </Button>\n            </div>\n        );\n\n    }\n\n}\n\nSnackBar.displayName = 'SnackBar';\n\nSnackBar.defaultProps = {\n    autoHideDuration: 0,\n    action: '关闭',\n    direction: 'bl'\n};\n\nSnackBar.propTypes = {\n    action: PropTypes.string,\n    autoHideDuration: PropTypes.number,\n    message: PropTypes.node.isRequired,\n    openOnMount: PropTypes.bool,\n    onHide: PropTypes.func,\n    onShow: PropTypes.func,\n    direction: PropTypes.oneOf(['tr', 'rt', 'rb', 'br', 'bl', 'lb', 'lt', 'tl', 'tc', 'rc', 'bc', 'lc'])\n};\n\n\nSnackBar.show = function (message, duration = 0, direction = 'bl') {\n\n    let doc = document;\n    let body = doc.body;\n    let container = doc.createElement('div');\n\n    body.appendChild(container);\n\n    let snackbar = (\n        <SnackBar\n            autoHideDuration={duration}\n            message={message}\n            direction={direction}\n            onHide={() => {\n\n                // 这里 delay 400 是因为要等动画搞完\n                setTimeout(\n                    () => {\n                        if (container) {\n                            ReactDOM.unmountComponentAtNode(container);\n                            body.removeChild(container);\n                            body = doc = container = snackbar = null;\n                        }\n                    },\n                    400\n                );\n\n            }} />\n    );\n\n    ReactDOM.render(snackbar, container, () => {\n        snackbar = React.cloneElement(snackbar, {open: true});\n        setTimeout(\n            () => {\n                ReactDOM.render(snackbar, container);\n            },\n            0\n        );\n    });\n\n    return snackbar;\n};\n"]}