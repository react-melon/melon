{"version":3,"sources":["/src/Layer.js"],"names":["Layer","args","onClickAway","bind","componentDidMount","renderLayer","componentDidUpdate","componentWillUnmount","unmountLayer","e","target","defaultPrevented","props","open","layer","contains","render","useLayerMask","document","createElement","classNames","addEventListener","push","setTimeout","window","className","join","body","appendChild","layerContent","removeEventListener","removeChild","getLayer","propTypes","func","bool","isRequired","defaultProps"],"mappings":"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","file":"Layer.js","sourcesContent":["/**\n * @file Layer\n * @author leon <ludafa@outlook.com>\n */\n\nimport {Component, PropTypes} from 'react';\nimport {\n    unstable_renderSubtreeIntoContainer,\n    unmountComponentAtNode\n} from 'react-dom';\n\nexport default class Layer extends Component {\n\n    constructor(...args) {\n        super(...args);\n        this.onClickAway = this.onClickAway.bind(this);\n    }\n\n    componentDidMount() {\n        this.renderLayer();\n    }\n\n    componentDidUpdate() {\n        this.renderLayer();\n    }\n\n    componentWillUnmount() {\n        this.unmountLayer();\n    }\n\n    onClickAway(e) {\n\n        let {target, defaultPrevented} = e;\n        let {onClickAway, open} = this.props;\n        let layer = this.layer;\n\n        if (defaultPrevented || !open || !layer) {\n            return;\n        }\n\n        if (target === layer || !layer.contains(target)) {\n            onClickAway && onClickAway();\n        }\n\n    }\n\n    renderLayer() {\n\n        let {open, render, useLayerMask} = this.props;\n\n        if (!open) {\n            this.unmountLayer();\n            return;\n        }\n\n        let layer = this.layer;\n\n        if (!layer) {\n\n            layer = this.layer = document.createElement('div');\n            let classNames = ['ui-layer'];\n\n            // 如果使用一个 div 作为遮罩，那么这里给 div 加 click 绑定\n            if (useLayerMask) {\n                layer.addEventListener('click', this.onClickAway);\n                classNames.push('variant-mask');\n            }\n            // 否则我们给 window 加事件绑定\n            else {\n\n                // 这么干是因为 Layer 通常是被 click 触发展现的\n                // 事件会继续冒泡到 window 上，这样我们这里就会被直接关闭掉\n                // 所以，这里用 setTimeout 做事件绑定\n                setTimeout(() => {\n                    window.addEventListener('click', this.onClickAway);\n                }, 0);\n            }\n\n            layer.className = classNames.join(' ');\n\n            document.body.appendChild(layer);\n        }\n\n        this.layerContent = unstable_renderSubtreeIntoContainer(\n            this,\n            render(),\n            layer\n        );\n\n    }\n\n    unmountLayer() {\n\n        let layer = this.layer;\n\n        if (!layer) {\n            return;\n        }\n\n        layer.removeEventListener('click', this.onClickAway);\n        window.removeEventListener('click', this.onClickAway);\n\n        unmountComponentAtNode(layer);\n        document.body.removeChild(layer);\n        this.layer = null;\n\n    }\n\n    getLayer() {\n        return this.layer;\n    }\n\n    render() {\n        return null;\n    }\n\n}\n\nLayer.propTypes = {\n    onClickAway: PropTypes.func,\n    open: PropTypes.bool.isRequired,\n    render: PropTypes.func.isRequired,\n    useLayerMask: PropTypes.bool.isRequired\n};\n\nLayer.defaultProps = {\n    open: false,\n    useLayerMask: true\n};\n"]}